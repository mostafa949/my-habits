<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¹Ø§Ø¯Ø§ØªÙŠ | Habit Tracker</title>

    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ø¹Ø§Ø¯Ø§ØªÙŠ">
    <meta name="description" content="ØªØ·Ø¨ÙŠÙ‚ ØªØªØ¨Ø¹ Ø§Ù„Ø¹Ø§Ø¯Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">

    <style>
        /* ============================================
           CSS VARIABLES & THEME
           ============================================ */
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: rgba(30, 41, 59, 0.85);
            --bg-card-hover: rgba(30, 41, 59, 0.95);
            --accent: #10b981;
            --accent-light: #34d399;
            --accent-dark: #059669;
            --gold: #f59e0b;
            --gold-light: #fbbf24;
            --blue: #3b82f6;
            --purple: #8b5cf6;
            --red: #ef4444;
            --pink: #ec4899;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border: rgba(255, 255, 255, 0.08);
            --border-light: rgba(255, 255, 255, 0.15);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.2);
            --radius: 20px;
            --radius-sm: 12px;
            --radius-xs: 8px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --font: 'Tajawal', sans-serif;
            --nav-height: 72px;
            --header-height: 60px;
        }

        /* ============================================
           RESET & BASE STYLES
           ============================================ */
        *, *::before, *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: var(--font);
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Background animated gradient */
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 30% 20%, rgba(16, 185, 129, 0.08) 0%, transparent 50%),
                        radial-gradient(circle at 70% 80%, rgba(245, 158, 11, 0.06) 0%, transparent 50%),
                        radial-gradient(circle at 50% 50%, rgba(59, 130, 246, 0.04) 0%, transparent 50%);
            animation: bgFloat 20s ease-in-out infinite;
            z-index: 0;
            pointer-events: none;
        }

        @keyframes bgFloat {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(2%, -2%) rotate(1deg); }
            66% { transform: translate(-1%, 1%) rotate(-1deg); }
        }

        /* ============================================
           SCROLLBAR STYLING
           ============================================ */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb {
            background: var(--accent);
            border-radius: 10px;
        }

        /* ============================================
           HEADER
           ============================================ */
        .app-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 100;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-title .logo {
            font-size: 28px;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .header-title h1 {
            font-size: 20px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent), var(--gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-date {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 400;
        }

        /* ============================================
           MAIN CONTENT
           ============================================ */
        .app-content {
            position: relative;
            z-index: 1;
            padding-top: calc(var(--header-height) + 10px);
            padding-bottom: calc(var(--nav-height) + 20px);
            min-height: 100vh;
        }

        .page {
            display: none;
            padding: 10px 16px 20px;
            animation: fadeIn 0.4s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ============================================
           HOME PAGE
           ============================================ */
        .greeting-section {
            text-align: center;
            padding: 20px 0 10px;
        }

        .greeting-text {
            font-size: 24px;
            font-weight: 300;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .greeting-name {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-light), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Progress Circle */
        .progress-container {
            display: flex;
            justify-content: center;
            padding: 20px 0;
            position: relative;
        }

        .progress-ring {
            position: relative;
            width: 200px;
            height: 200px;
        }

        .progress-ring svg {
            transform: rotate(-90deg);
            width: 200px;
            height: 200px;
        }

        .progress-ring .bg-circle {
            fill: none;
            stroke: var(--border);
            stroke-width: 8;
        }

        .progress-ring .progress-circle {
            fill: none;
            stroke: url(#progressGradient);
            stroke-width: 8;
            stroke-linecap: round;
            transition: stroke-dashoffset 1s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .progress-ring .center-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .progress-percentage {
            font-size: 42px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--accent), var(--gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
        }

        .progress-label {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* Stats Row */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .stat-card {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 16px 10px;
            text-align: center;
            transition: var(--transition);
        }

        .stat-card:active {
            transform: scale(0.95);
        }

        .stat-emoji {
            font-size: 24px;
            margin-bottom: 6px;
        }

        .stat-value {
            font-size: 22px;
            font-weight: 800;
            color: var(--text-primary);
        }

        .stat-label {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        /* Quote Card */
        .quote-card {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(245, 158, 11, 0.1));
            border: 1px solid rgba(16, 185, 129, 0.2);
            border-radius: var(--radius);
            padding: 20px;
            margin: 15px 0;
            position: relative;
            overflow: hidden;
        }

        .quote-card::before {
            content: 'â';
            position: absolute;
            top: -10px;
            right: 10px;
            font-size: 60px;
            opacity: 0.1;
            color: var(--accent);
        }

        .quote-text {
            font-size: 15px;
            line-height: 1.8;
            color: var(--text-primary);
            font-weight: 500;
        }

        .quote-source {
            font-size: 12px;
            color: var(--accent);
            margin-top: 10px;
            font-weight: 700;
        }

        /* Quick Habits */
        .section-title {
            font-size: 18px;
            font-weight: 700;
            margin: 20px 0 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ============================================
           HABIT CARDS
           ============================================ */
        .habits-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .habit-card {
            background: var(--bg-card);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 18px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .habit-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 4px;
            height: 100%;
            border-radius: 0 4px 4px 0;
        }

        .habit-card:active {
            transform: scale(0.98);
        }

        .habit-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 4px;
            cursor: pointer;
        }

        .habit-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .habit-emoji {
            font-size: 32px;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-sm);
            background: rgba(255, 255, 255, 0.05);
        }

        .habit-name {
            font-size: 16px;
            font-weight: 700;
        }

        .habit-streak {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 4px;
            margin-top: 2px;
        }

        .habit-streak .fire {
            color: #ff6b35;
        }

        .habit-progress-badge {
            font-size: 13px;
            font-weight: 700;
            padding: 6px 12px;
            border-radius: 20px;
            min-width: 55px;
            text-align: center;
        }

        /* Sub Items (Prayers) */
        .habit-sub-items {
            margin-top: 14px;
            padding-top: 14px;
            border-top: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .sub-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 14px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: var(--radius-xs);
            transition: var(--transition);
        }

        .sub-item:active {
            background: rgba(255, 255, 255, 0.08);
        }

        .sub-item-name {
            font-size: 15px;
            font-weight: 500;
        }

        /* Custom Checkbox */
        .custom-check {
            position: relative;
            width: 28px;
            height: 28px;
            cursor: pointer;
        }

        .custom-check input {
            display: none;
        }

        .checkmark {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 2px solid var(--text-muted);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-size: 14px;
        }

        .custom-check input:checked + .checkmark {
            border-color: var(--accent);
            background: var(--accent);
            animation: checkBounce 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .custom-check input:checked + .checkmark::after {
            content: 'âœ“';
            color: white;
            font-weight: 700;
        }

        @keyframes checkBounce {
            0% { transform: scale(1); }
            30% { transform: scale(1.3); }
            60% { transform: scale(0.9); }
            100% { transform: scale(1); }
        }

        /* Boolean Habit Toggle */
        .habit-toggle-btn {
            width: 100%;
            padding: 14px;
            border: 2px dashed var(--border-light);
            border-radius: var(--radius-sm);
            background: transparent;
            color: var(--text-secondary);
            font-family: var(--font);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .habit-toggle-btn.completed {
            border-color: var(--accent);
            background: rgba(16, 185, 129, 0.1);
            color: var(--accent);
            border-style: solid;
        }

        .habit-toggle-btn:active {
            transform: scale(0.97);
        }

        /* ============================================
           ADD HABIT - FAB BUTTON
           ============================================ */
        .fab-btn {
            position: fixed;
            bottom: calc(var(--nav-height) + 20px);
            left: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            color: white;
            border: none;
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.4);
            transition: var(--transition);
            z-index: 50;
        }

        .fab-btn:active {
            transform: scale(0.9);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            z-index: 200;
            display: none;
            align-items: flex-end;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: var(--radius) var(--radius) 0 0;
            width: 100%;
            max-width: 500px;
            max-height: 85vh;
            overflow-y: auto;
            padding: 24px 20px 40px;
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }

        .modal-handle {
            width: 40px;
            height: 4px;
            background: var(--text-muted);
            border-radius: 4px;
            margin: 0 auto 20px;
        }

        .modal-title {
            font-size: 22px;
            font-weight: 800;
            margin-bottom: 20px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 18px;
        }

        .form-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: block;
        }

        .form-input {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-family: var(--font);
            font-size: 16px;
            font-weight: 500;
            transition: var(--transition);
            outline: none;
        }

        .form-input:focus {
            border-color: var(--accent);
            background: rgba(16, 185, 129, 0.05);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        /* Emoji Picker */
        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
        }

        .emoji-option {
            width: 100%;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid transparent;
            border-radius: var(--radius-xs);
            cursor: pointer;
            transition: var(--transition);
        }

        .emoji-option:active, .emoji-option.selected {
            border-color: var(--accent);
            background: rgba(16, 185, 129, 0.1);
            transform: scale(1.1);
        }

        /* Color Picker */
        .color-grid {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .color-option {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .color-option.selected {
            border-color: white;
            transform: scale(1.15);
        }

        .color-option.selected::after {
            content: 'âœ“';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: 700;
            font-size: 14px;
        }

        /* Suggested Habits */
        .suggestions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .suggestion-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            border-radius: var(--radius-xs);
            color: var(--text-primary);
            font-family: var(--font);
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .suggestion-btn:active {
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--accent);
        }

        .suggestion-btn .s-emoji {
            font-size: 20px;
        }

        .submit-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--accent), var(--accent-dark));
            border: none;
            border-radius: var(--radius-sm);
            color: white;
            font-family: var(--font);
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }

        .submit-btn:active {
            transform: scale(0.97);
            opacity: 0.9;
        }

        .submit-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        /* ============================================
           STATS PAGE
           ============================================ */
        .week-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
            margin: 15px 0;
        }

        .week-day {
            text-align: center;
            padding: 10px 4px;
            border-radius: var(--radius-xs);
            background: var(--bg-card);
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        .week-day.today {
            border-color: var(--accent);
            background: rgba(16, 185, 129, 0.1);
        }

        .week-day .day-name {
            font-size: 10px;
            color: var(--text-muted);
            font-weight: 600;
        }

        .week-day .day-num {
            font-size: 16px;
            font-weight: 700;
            margin: 4px 0;
        }

        .week-day .day-dots {
            display: flex;
            justify-content: center;
            gap: 3px;
            flex-wrap: wrap;
        }

        .day-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--text-muted);
        }

        .day-dot.completed {
            background: var(--accent);
        }

        .day-dot.partial {
            background: var(--gold);
        }

        /* Streaks List */
        .streak-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 14px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .streak-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .streak-info .s-emoji {
            font-size: 24px;
        }

        .streak-info .s-name {
            font-size: 14px;
            font-weight: 600;
        }

        .streak-value {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 18px;
            font-weight: 800;
            color: var(--gold);
        }

        /* Bar Chart */
        .bar-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 150px;
            padding: 10px 0;
            margin: 15px 0;
            border-bottom: 1px solid var(--border);
        }

        .bar-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            flex: 1;
        }

        .bar {
            width: 28px;
            border-radius: 6px 6px 0 0;
            background: linear-gradient(to top, var(--accent), var(--accent-light));
            transition: height 1s cubic-bezier(0.4, 0, 0.2, 1);
            min-height: 4px;
        }

        .bar-label {
            font-size: 10px;
            color: var(--text-muted);
            font-weight: 600;
        }

        /* ============================================
           SETTINGS PAGE
           ============================================ */
        .settings-group {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
            margin-bottom: 16px;
        }

        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 18px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: var(--transition);
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .settings-item:active {
            background: rgba(255, 255, 255, 0.03);
        }

        .settings-item-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .settings-item-info .si-emoji {
            font-size: 22px;
        }

        .settings-item-info .si-text {
            font-size: 15px;
            font-weight: 500;
        }

        .settings-item .si-value {
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 48px;
            height: 26px;
        }

        .toggle-switch input { display: none; }

        .toggle-slider {
            position: absolute;
            inset: 0;
            background: var(--text-muted);
            border-radius: 26px;
            cursor: pointer;
            transition: var(--transition);
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            top: 3px;
            right: 3px;
            transition: var(--transition);
        }

        .toggle-switch input:checked + .toggle-slider {
            background: var(--accent);
        }

        .toggle-switch input:checked + .toggle-slider::before {
            transform: translateX(-22px);
        }

        /* Danger Button */
        .danger-btn {
            width: 100%;
            padding: 14px;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: var(--radius-sm);
            color: var(--red);
            font-family: var(--font);
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
        }

        .danger-btn:active {
            background: rgba(239, 68, 68, 0.2);
        }

        /* ============================================
           BOTTOM NAVIGATION
           ============================================ */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: var(--nav-height);
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-around;
            z-index: 100;
            padding-bottom: env(safe-area-inset-bottom, 0);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px 16px;
            cursor: pointer;
            transition: var(--transition);
            border-radius: var(--radius-xs);
            position: relative;
            -webkit-tap-highlight-color: transparent;
        }

        .nav-item .nav-icon {
            font-size: 22px;
            transition: var(--transition);
        }

        .nav-item .nav-label {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-muted);
            transition: var(--transition);
        }

        .nav-item.active .nav-icon {
            transform: scale(1.15);
        }

        .nav-item.active .nav-label {
            color: var(--accent);
            font-weight: 700;
        }

        .nav-item.active::before {
            content: '';
            position: absolute;
            top: -1px;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background: var(--accent);
            border-radius: 0 0 4px 4px;
        }

        /* ============================================
           CONFETTI ANIMATION
           ============================================ */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 300;
            overflow: hidden;
        }

        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            top: -10px;
            animation: confettiFall 3s linear forwards;
        }

        @keyframes confettiFall {
            0% { top: -10px; opacity: 1; transform: rotate(0deg); }
            100% { top: 110vh; opacity: 0; transform: rotate(720deg); }
        }

        /* ============================================
           EMPTY STATE
           ============================================ */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
        }

        .empty-state .empty-emoji {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .empty-state .empty-text {
            font-size: 16px;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* ============================================
           DELETE BUTTON
           ============================================ */
        .delete-habit-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 18px;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 8px;
            transition: var(--transition);
            margin-right: 8px;
        }

        .delete-habit-btn:active {
            color: var(--red);
            background: rgba(239, 68, 68, 0.1);
        }

        /* ============================================
           NOTIFICATION TOAST
           ============================================ */
        .toast {
            position: fixed;
            top: calc(var(--header-height) + 10px);
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: var(--bg-secondary);
            border: 1px solid var(--accent);
            color: var(--text-primary);
            padding: 14px 24px;
            border-radius: var(--radius-sm);
            font-family: var(--font);
            font-size: 14px;
            font-weight: 600;
            z-index: 250;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            white-space: nowrap;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        /* ============================================
           INSTALL BANNER
           ============================================ */
        .install-banner {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(245, 158, 11, 0.15));
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: var(--radius-sm);
            padding: 14px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            display: none;
        }

        .install-banner.show { display: flex; }

        .install-banner-text {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .install-btn {
            padding: 8px 16px;
            background: var(--accent);
            border: none;
            border-radius: 20px;
            color: white;
            font-family: var(--font);
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            white-space: nowrap;
        }

        .dismiss-install {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 18px;
            cursor: pointer;
            padding: 0 4px;
            margin-right: 8px;
        }

        /* ============================================
           RESPONSIVE
           ============================================ */
        @media (min-width: 500px) {
            .app-content {
                max-width: 500px;
                margin: 0 auto;
            }
            .bottom-nav {
                max-width: 500px;
                left: 50%;
                transform: translateX(-50%);
                border-radius: var(--radius) var(--radius) 0 0;
            }
        }
    </style>
</head>
<body>

    <!-- ============================================
         HEADER
         ============================================ -->
    <header class="app-header">
        <div class="header-title">
            <span class="logo">ğŸŒ™</span>
            <div>
                <h1>Ø¹Ø§Ø¯Ø§ØªÙŠ</h1>
            </div>
        </div>
        <span class="header-date" id="headerDate"></span>
    </header>

    <!-- ============================================
         TOAST NOTIFICATION
         ============================================ -->
    <div class="toast" id="toast"></div>

    <!-- ============================================
         MAIN CONTENT
         ============================================ -->
    <main class="app-content">

        <!-- ===== HOME PAGE ===== -->
        <div class="page active" id="page-home">

            <!-- Install Banner -->
            <div class="install-banner" id="installBanner">
                <div style="display:flex;align-items:center;gap:8px">
                    <button class="dismiss-install" onclick="dismissInstall()">âœ•</button>
                    <span class="install-banner-text">ğŸ“² Ø­Ù…Ù‘Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø²Ùƒ</span>
                </div>
                <button class="install-btn" onclick="installApp()">ØªØ­Ù…ÙŠÙ„</button>
            </div>

            <div class="greeting-section">
                <p class="greeting-text" id="greetingText"></p>
                <p class="greeting-name">ÙƒÙŠÙ ÙŠÙˆÙ…ÙƒØŸ ğŸ’«</p>
            </div>

            <!-- Progress Ring -->
            <div class="progress-container">
                <div class="progress-ring">
                    <svg viewBox="0 0 200 200">
                        <defs>
                            <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#10b981"/>
                                <stop offset="100%" style="stop-color:#f59e0b"/>
                            </linearGradient>
                        </defs>
                        <circle class="bg-circle" cx="100" cy="100" r="85"/>
                        <circle class="progress-circle" id="progressCircle" cx="100" cy="100" r="85"
                                stroke-dasharray="534" stroke-dashoffset="534"/>
                    </svg>
                    <div class="center-content">
                        <div class="progress-percentage" id="progressPercent">0%</div>
                        <div class="progress-label">Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„ÙŠÙˆÙ…</div>
                    </div>
                </div>
            </div>

            <!-- Stats Row -->
            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-emoji">ğŸ”¥</div>
                    <div class="stat-value" id="statStreak">0</div>
                    <div class="stat-label">Ø£ÙØ¶Ù„ Ø³Ù„Ø³Ù„Ø©</div>
                </div>
                <div class="stat-card">
                    <div class="stat-emoji">âœ…</div>
                    <div class="stat-value" id="statCompleted">0</div>
                    <div class="stat-label">Ù…ÙƒØªÙ…Ù„ Ø§Ù„ÙŠÙˆÙ…</div>
                </div>
                <div class="stat-card">
                    <div class="stat-emoji">ğŸ¯</div>
                    <div class="stat-value" id="statTotal">0</div>
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù‡Ø§Ù…</div>
                </div>
            </div>

            <!-- Quote -->
            <div class="quote-card">
                <p class="quote-text" id="quoteText"></p>
                <p class="quote-source" id="quoteSource"></p>
            </div>

            <!-- Quick Habits Preview -->
            <h3 class="section-title">âš¡ Ù†Ø¸Ø±Ø© Ø³Ø±ÙŠØ¹Ø©</h3>
            <div id="quickHabits" class="habits-list"></div>
        </div>

        <!-- ===== HABITS PAGE ===== -->
        <div class="page" id="page-habits">
            <h2 class="section-title" style="font-size:22px; margin-top:5px;">ğŸ“‹ Ø¹Ø§Ø¯Ø§ØªÙŠ</h2>
            <div id="habitsContainer" class="habits-list"></div>
        </div>

        <!-- ===== STATS PAGE ===== -->
        <div class="page" id="page-stats">
            <h2 class="section-title" style="font-size:22px; margin-top:5px;">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h2>

            <!-- Weekly Calendar -->
            <h3 class="section-title">ğŸ“… Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</h3>
            <div class="week-calendar" id="weekCalendar"></div>

            <!-- Bar Chart -->
            <h3 class="section-title">ğŸ“ˆ Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</h3>
            <div class="bar-chart" id="barChart"></div>

            <!-- Streaks -->
            <h3 class="section-title">ğŸ”¥ Ø§Ù„Ø³Ù„Ø§Ø³Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h3>
            <div id="streaksList"></div>
        </div>

        <!-- ===== SETTINGS PAGE ===== -->
        <div class="page" id="page-settings">
            <h2 class="section-title" style="font-size:22px; margin-top:5px;">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>

            <div class="settings-group">
                <div class="settings-item" onclick="toggleNotifications()">
                    <div class="settings-item-info">
                        <span class="si-emoji">ğŸ””</span>
                        <span class="si-text">Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª</span>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="notifToggle">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="settings-item" onclick="exportData()">
                    <div class="settings-item-info">
                        <span class="si-emoji">ğŸ“¤</span>
                        <span class="si-text">ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                    </div>
                    <span class="si-value">JSON</span>
                </div>
                <div class="settings-item" onclick="importDataClick()">
                    <div class="settings-item-info">
                        <span class="si-emoji">ğŸ“¥</span>
                        <span class="si-text">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
                    </div>
                    <span class="si-value">JSON</span>
                </div>
            </div>

            <div class="settings-group">
                <div class="settings-item">
                    <div class="settings-item-info">
                        <span class="si-emoji">ğŸ“±</span>
                        <span class="si-text">Ø§Ù„Ø¥ØµØ¯Ø§Ø±</span>
                    </div>
                    <span class="si-value">1.0.0</span>
                </div>
                <div class="settings-item">
                    <div class="settings-item-info">
                        <span class="si-emoji">ğŸ’š</span>
                        <span class="si-text">ØµÙ†Ø¹ Ø¨Ø­Ø¨</span>
                    </div>
                    <span class="si-value">ğŸŒ™</span>
                </div>
            </div>

            <button class="danger-btn" onclick="resetAllData()" style="margin-top:10px;">
                ğŸ—‘ï¸ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            </button>

            <!-- Hidden file input for import -->
            <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
        </div>
    </main>

    <!-- ============================================
         FAB BUTTON - Always Visible
         ============================================ -->
    <button class="fab-btn" id="fabBtn" onclick="openAddModal()">+</button>

    <!-- ============================================
         ADD HABIT MODAL
         ============================================ -->
    <div class="modal-overlay" id="addModal">
        <div class="modal-content">
            <div class="modal-handle"></div>
            <h2 class="modal-title">âœ¨ Ø¥Ø¶Ø§ÙØ© Ø¹Ø§Ø¯Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>

            <!-- Suggestions -->
            <div class="form-group">
                <label class="form-label">ğŸ’¡ Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø³Ø±ÙŠØ¹Ø©</label>
                <div class="suggestions-grid">
                    <button class="suggestion-btn" onclick="applySuggestion('ğŸ“–','Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚Ø±Ø¢Ù†','#3b82f6')">
                        <span class="s-emoji">ğŸ“–</span> Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚Ø±Ø¢Ù†
                    </button>
                    <button class="suggestion-btn" onclick="applySuggestion('ğŸ¤²','Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­ ÙˆØ§Ù„Ù…Ø³Ø§Ø¡','#8b5cf6')">
                        <span class="s-emoji">ğŸ¤²</span> Ø§Ù„Ø£Ø°ÙƒØ§Ø±
                    </button>
                    <button class="suggestion-btn" onclick="applySuggestion('ğŸƒ','Ø§Ù„Ø±ÙŠØ§Ø¶Ø©','#ef4444')">
                        <span class="s-emoji">ğŸƒ</span> Ø§Ù„Ø±ÙŠØ§Ø¶Ø©
                    </button>
                    <button class="suggestion-btn" onclick="applySuggestion('ğŸ’§','Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡','#06b6d4')">
                        <span class="s-emoji">ğŸ’§</span> Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡
                    </button>
                    <button class="suggestion-btn" onclick="applySuggestion('ğŸ“š','Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©','#f59e0b')">
                        <span class="s-emoji">ğŸ“š</span> Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©
                    </button>
                    <button class="suggestion-btn" onclick="applySuggestion('ğŸ˜´','Ø§Ù„Ù†ÙˆÙ… Ø§Ù„Ù…Ø¨ÙƒØ±','#6366f1')">
                        <span class="s-emoji">ğŸ˜´</span> Ø§Ù„Ù†ÙˆÙ… Ø§Ù„Ù…Ø¨ÙƒØ±
                    </button>
                    <button class="suggestion-btn" onclick="applySuggestion('ğŸ™','ØµÙ„Ø§Ø© Ø§Ù„Ø³Ù†Ù†','#14b8a6')">
                        <span class="s-emoji">ğŸ™</span> ØµÙ„Ø§Ø© Ø§Ù„Ø³Ù†Ù†
                    </button>
                    <button class="suggestion-btn" onclick="applySuggestion('ğŸ’°','Ø§Ù„ØµØ¯Ù‚Ø©','#f97316')">
                        <span class="s-emoji">ğŸ’°</span> Ø§Ù„ØµØ¯Ù‚Ø©
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">ğŸ“ Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¯Ø©</label>
                <input type="text" class="form-input" id="habitNameInput" 
                       placeholder="Ù…Ø«Ø§Ù„: Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚Ø±Ø¢Ù†" maxlength="30">
            </div>

            <div class="form-group">
                <label class="form-label">ğŸ˜Š Ø§Ø®ØªØ± Ø£ÙŠÙ‚ÙˆÙ†Ø©</label>
                <div class="emoji-grid" id="emojiGrid"></div>
            </div>

            <div class="form-group">
                <label class="form-label">ğŸ¨ Ø§Ø®ØªØ± Ù„ÙˆÙ†</label>
                <div class="color-grid" id="colorGrid"></div>
            </div>

            <button class="submit-btn" id="submitHabit" onclick="addNewHabit()">
                â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø§Ø¯Ø©
            </button>
            <button class="submit-btn" onclick="closeAddModal()" 
                    style="background:transparent; border:1px solid var(--border); margin-top:8px; color:var(--text-secondary);">
                Ø¥Ù„ØºØ§Ø¡
            </button>
        </div>
    </div>

    <!-- ============================================
         CONFETTI CONTAINER
         ============================================ -->
    <div class="confetti-container" id="confettiContainer"></div>

    <!-- ============================================
         BOTTOM NAVIGATION
         ============================================ -->
    <nav class="bottom-nav">
        <div class="nav-item active" onclick="switchPage('home', this)">
            <span class="nav-icon">ğŸ </span>
            <span class="nav-label">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
        </div>
        <div class="nav-item" onclick="switchPage('habits', this)">
            <span class="nav-icon">âœ…</span>
            <span class="nav-label">Ø§Ù„Ø¹Ø§Ø¯Ø§Øª</span>
        </div>
        <div class="nav-item" onclick="switchPage('stats', this)">
            <span class="nav-icon">ğŸ“Š</span>
            <span class="nav-label">Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</span>
        </div>
        <div class="nav-item" onclick="switchPage('settings', this)">
            <span class="nav-icon">âš™ï¸</span>
            <span class="nav-label">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
        </div>
    </nav>

    <!-- ============================================
         JAVASCRIPT
         ============================================ -->
    <script>
        // ============================================
        // APP STATE & CONSTANTS
        // ============================================

        const STORAGE_KEY = 'habitTrackerData';
        const ARABIC_DAYS = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
        const SHORT_DAYS = ['Ø£Ø­Ø¯', 'Ø¥Ø«Ù†', 'Ø«Ù„Ø§', 'Ø£Ø±Ø¨', 'Ø®Ù…ÙŠ', 'Ø¬Ù…Ø¹', 'Ø³Ø¨Øª'];

        const EMOJIS = ['ğŸ“–','ğŸ¤²','ğŸƒ','ğŸ’§','ğŸ“š','ğŸ˜´','ğŸ™','ğŸ’°','ğŸ¯','ğŸ’ª','ğŸ§˜','ğŸ¥—','âœï¸','ğŸŒ…','ğŸŒ™','ğŸ•Œ','â­','ğŸ’'];
        const COLORS = ['#10b981','#3b82f6','#f59e0b','#ef4444','#8b5cf6','#ec4899','#06b6d4','#f97316','#14b8a6','#6366f1'];

        const QUOTES = [
            { text: 'Ø¥ÙÙ†ÙÙ‘ Ù…ÙØ¹Ù Ø§Ù„Ù’Ø¹ÙØ³Ù’Ø±Ù ÙŠÙØ³Ù’Ø±Ù‹Ø§', source: 'Ø³ÙˆØ±Ø© Ø§Ù„Ø´Ø±Ø­ - Ø¢ÙŠØ© Ù¦' },
            { text: 'ÙˆÙÙ…ÙÙ† ÙŠÙØªÙÙ‘Ù‚Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙŠÙØ¬Ù’Ø¹ÙÙ„ Ù„ÙÙ‘Ù‡Ù Ù…ÙØ®Ù’Ø±ÙØ¬Ù‹Ø§', source: 'Ø³ÙˆØ±Ø© Ø§Ù„Ø·Ù„Ø§Ù‚ - Ø¢ÙŠØ© Ù¢' },
            { text: 'ÙÙØ§Ø°Ù’ÙƒÙØ±ÙÙˆÙ†ÙÙŠ Ø£ÙØ°Ù’ÙƒÙØ±Ù’ÙƒÙÙ…Ù’ ÙˆÙØ§Ø´Ù’ÙƒÙØ±ÙÙˆØ§ Ù„ÙÙŠ ÙˆÙÙ„ÙØ§ ØªÙÙƒÙ’ÙÙØ±ÙÙˆÙ†Ù', source: 'Ø³ÙˆØ±Ø© Ø§Ù„Ø¨Ù‚Ø±Ø© - Ø¢ÙŠØ© Ù¡Ù¥Ù¢' },
            { text: 'ÙˆÙÙ‚ÙÙ„ Ø±ÙÙ‘Ø¨ÙÙ‘ Ø²ÙØ¯Ù’Ù†ÙÙŠ Ø¹ÙÙ„Ù’Ù…Ù‹Ø§', source: 'Ø³ÙˆØ±Ø© Ø·Ù‡ - Ø¢ÙŠØ© Ù¡Ù¡Ù¤' },
            { text: 'Ø±ÙØ¨ÙÙ‘Ù†ÙØ§ Ø¢ØªÙÙ†ÙØ§ ÙÙÙŠ Ø§Ù„Ø¯ÙÙ‘Ù†Ù’ÙŠÙØ§ Ø­ÙØ³ÙÙ†ÙØ©Ù‹ ÙˆÙÙÙÙŠ Ø§Ù„Ù’Ø¢Ø®ÙØ±ÙØ©Ù Ø­ÙØ³ÙÙ†ÙØ©Ù‹', source: 'Ø³ÙˆØ±Ø© Ø§Ù„Ø¨Ù‚Ø±Ø© - Ø¢ÙŠØ© Ù¢Ù Ù¡' },
            { text: 'ÙˆÙÙ„ÙØ§ ØªÙÙŠÙ’Ø£ÙØ³ÙÙˆØ§ Ù…ÙÙ† Ø±ÙÙ‘ÙˆÙ’Ø­Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù', source: 'Ø³ÙˆØ±Ø© ÙŠÙˆØ³Ù - Ø¢ÙŠØ© Ù¨Ù§' },
            { text: 'Ø£ÙÙ„ÙØ§ Ø¨ÙØ°ÙÙƒÙ’Ø±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ØªÙØ·Ù’Ù…ÙØ¦ÙÙ†ÙÙ‘ Ø§Ù„Ù’Ù‚ÙÙ„ÙÙˆØ¨Ù', source: 'Ø³ÙˆØ±Ø© Ø§Ù„Ø±Ø¹Ø¯ - Ø¢ÙŠØ© Ù¢Ù¨' },
            { text: 'Ø®ÙŠØ±ÙƒÙ… Ù…Ù† ØªØ¹Ù„Ù… Ø§Ù„Ù‚Ø±Ø¢Ù† ÙˆØ¹Ù„Ù…Ù‡', source: 'Ø­Ø¯ÙŠØ« Ù†Ø¨ÙˆÙŠ Ø´Ø±ÙŠÙ' },
            { text: 'Ø¥Ù†Ù…Ø§ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø¨Ø§Ù„Ù†ÙŠØ§Øª ÙˆØ¥Ù†Ù…Ø§ Ù„ÙƒÙ„ Ø§Ù…Ø±Ø¦ Ù…Ø§ Ù†ÙˆÙ‰', source: 'Ø­Ø¯ÙŠØ« Ù†Ø¨ÙˆÙŠ Ø´Ø±ÙŠÙ' },
            { text: 'Ø£Ø­Ø¨ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù„Ù‡ Ø£Ø¯ÙˆÙ…Ù‡Ø§ ÙˆØ¥Ù† Ù‚Ù„', source: 'Ø­Ø¯ÙŠØ« Ù†Ø¨ÙˆÙŠ Ø´Ø±ÙŠÙ' },
        ];

        // Default habits that come with the app
        const DEFAULT_HABITS = [
            {
                id: 'prayer',
                name: 'Ø§Ù„ØµÙ„ÙˆØ§Øª Ø§Ù„Ù…ÙØ±ÙˆØ¶Ø©',
                emoji: 'ğŸ•Œ',
                color: '#10b981',
                type: 'multi',
                subItems: [
                    { id: 'fajr', name: 'Ø§Ù„ÙØ¬Ø±' },
                    { id: 'dhuhr', name: 'Ø§Ù„Ø¸Ù‡Ø±' },
                    { id: 'asr', name: 'Ø§Ù„Ø¹ØµØ±' },
                    { id: 'maghrib', name: 'Ø§Ù„Ù…ØºØ±Ø¨' },
                    { id: 'isha', name: 'Ø§Ù„Ø¹Ø´Ø§Ø¡' }
                ],
                deletable: false
            },
            {
                id: 'avoid-haram',
                name: 'Ø§Ù„Ø§Ø¨ØªØ¹Ø§Ø¯ Ø¹Ù† Ø§Ù„Ø­Ø±Ø§Ù…',
                emoji: 'ğŸ›¡ï¸',
                color: '#f59e0b',
                type: 'boolean',
                deletable: false
            }
        ];

        let appData = {
            habits: [],
            history: {},
            settings: {
                notifications: false
            }
        };

        let selectedEmoji = 'ğŸ“–';
        let selectedColor = '#10b981';
        let deferredPrompt = null;

        // ============================================
        // INITIALIZATION
        // ============================================

        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            initUI();
            registerSW();
        });

        /** Load data from localStorage or set defaults */
        function loadData() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                try {
                    appData = JSON.parse(saved);
                    // Ensure default habits always exist
                    DEFAULT_HABITS.forEach(dh => {
                        if (!appData.habits.find(h => h.id === dh.id)) {
                            appData.habits.unshift(dh);
                        }
                    });
                } catch (e) {
                    console.error('Error loading data:', e);
                    appData.habits = [...DEFAULT_HABITS];
                    appData.history = {};
                }
            } else {
                appData.habits = [...DEFAULT_HABITS];
                appData.history = {};
            }
            if (!appData.settings) appData.settings = { notifications: false };
            saveData();
        }

        /** Save data to localStorage */
        function saveData() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(appData));
        }

        /** Initialize all UI elements */
        function initUI() {
            setHeaderDate();
            setGreeting();
            setQuote();
            buildEmojiGrid();
            buildColorGrid();
            renderAll();
            document.getElementById('notifToggle').checked = appData.settings.notifications;
        }

        // ============================================
        // DATE & TIME HELPERS
        // ============================================

        /** Get today's date string in YYYY-MM-DD format */
        function getToday() {
            return formatDate(new Date());
        }

        /** Format a Date object to YYYY-MM-DD */
        function formatDate(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }

        /** Set the header date display */
        function setHeaderDate() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('headerDate').textContent = now.toLocaleDateString('ar-EG', options);
        }

        /** Set greeting based on time of day */
        function setGreeting() {
            const hour = new Date().getHours();
            let greeting = '';
            if (hour < 5) greeting = 'Ù„ÙŠÙ„Ø© Ø³Ø¹ÙŠØ¯Ø© ğŸŒ™';
            else if (hour < 12) greeting = 'ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ± â˜€ï¸';
            else if (hour < 17) greeting = 'Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ± ğŸŒ¤ï¸';
            else greeting = 'Ù…Ø³Ø§Ø¡ Ø§Ù„Ù†ÙˆØ± ğŸŒ™';
            document.getElementById('greetingText').textContent = greeting;
        }

        /** Set daily motivational quote */
        function setQuote() {
            const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / (1000 * 60 * 60 * 24));
            const quote = QUOTES[dayOfYear % QUOTES.length];
            document.getElementById('quoteText').textContent = `ï´¿ ${quote.text} ï´¾`;
            document.getElementById('quoteSource').textContent = `â€” ${quote.source}`;
        }

        // ============================================
        // RENDERING
        // ============================================

        /** Re-render all pages */
        function renderAll() {
            renderHabitsPage();
            renderHomePage();
            renderStatsPage();
        }

        /** Render the home page with progress and quick view */
        function renderHomePage() {
            const today = getToday();
            const todayData = appData.history[today] || {};
            const habits = appData.habits;

            // Calculate overall completion
            let totalItems = 0;
            let completedItems = 0;

            habits.forEach(h => {
                if (h.type === 'multi') {
                    totalItems += h.subItems.length;
                    const sub = todayData[h.id] || {};
                    completedItems += h.subItems.filter(s => sub[s.id]).length;
                } else {
                    totalItems += 1;
                    if (todayData[h.id]) completedItems += 1;
                }
            });

            const percent = totalItems > 0 ? Math.round((completedItems / totalItems) * 100) : 0;

            // Update progress circle animation
            const circle = document.getElementById('progressCircle');
            const circumference = 2 * Math.PI * 85;
            const offset = circumference - (percent / 100) * circumference;
            circle.style.strokeDashoffset = offset;

            document.getElementById('progressPercent').textContent = percent + '%';

            // Update stat cards
            document.getElementById('statCompleted').textContent = completedItems;
            document.getElementById('statTotal').textContent = totalItems;
            document.getElementById('statStreak').textContent = getBestStreak();

            // Render quick habits preview cards
            const quickContainer = document.getElementById('quickHabits');
            quickContainer.innerHTML = '';
            habits.forEach(h => {
                quickContainer.innerHTML += renderHabitCardMini(h, todayData);
            });
        }

        /** Render mini habit card for home page quick view */
        function renderHabitCardMini(habit, todayData) {
            let completed = 0, total = 0, progressText = '';
            if (habit.type === 'multi') {
                total = habit.subItems.length;
                const sub = todayData[habit.id] || {};
                completed = habit.subItems.filter(s => sub[s.id]).length;
                progressText = `${completed}/${total}`;
            } else {
                total = 1;
                completed = todayData[habit.id] ? 1 : 0;
                progressText = completed ? 'âœ“' : 'â€”';
            }
            const pct = total > 0 ? Math.round((completed / total) * 100) : 0;
            const bgColor = pct === 100 ? habit.color : 'rgba(255,255,255,0.08)';
            const textColor = pct === 100 ? '#fff' : 'var(--text-secondary)';

            return `
                <div class="habit-card" style="padding:14px 16px; cursor:pointer;" 
                     onclick="switchPage('habits', document.querySelectorAll('.nav-item')[1])">
                    <div style="display:flex; align-items:center; justify-content:space-between;">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <span style="font-size:24px;">${habit.emoji}</span>
                            <span style="font-size:14px; font-weight:600;">${habit.name}</span>
                        </div>
                        <span class="habit-progress-badge" 
                              style="background:${bgColor}; color:${textColor}; border:1px solid ${habit.color}30;">
                            ${progressText}
                        </span>
                    </div>
                </div>
            `;
        }

        /** Render the full habits page with detailed cards */
        function renderHabitsPage() {
            const container = document.getElementById('habitsContainer');
            const today = getToday();
            const todayData = appData.history[today] || {};
            container.innerHTML = '';

            appData.habits.forEach(habit => {
                container.innerHTML += renderHabitCardFull(habit, todayData);
            });
        }

        /** Render a full detailed habit card */
        function renderHabitCardFull(habit, todayData) {
            const streak = calculateStreak(habit.id);
            const deleteBtn = habit.deletable !== false
                ? `<button class="delete-habit-btn" onclick="deleteHabit('${habit.id}', event)" title="Ø­Ø°Ù">ğŸ—‘ï¸</button>`
                : '';

            if (habit.type === 'multi') {
                const sub = todayData[habit.id] || {};
                const completed = habit.subItems.filter(s => sub[s.id]).length;
                const total = habit.subItems.length;
                const pct = Math.round((completed / total) * 100);
                const bgColor = pct === 100 ? habit.color : 'rgba(255,255,255,0.08)';
                const textColor = pct === 100 ? '#fff' : 'var(--text-secondary)';

                let subItemsHtml = habit.subItems.map(s => `
                    <div class="sub-item">
                        <span class="sub-item-name">${s.name}</span>
                        <label class="custom-check">
                            <input type="checkbox" ${sub[s.id] ? 'checked' : ''} 
                                   onchange="toggleSubItem('${habit.id}', '${s.id}', this.checked)">
                            <span class="checkmark" style="${sub[s.id] ? `background:${habit.color}; border-color:${habit.color};` : ''}"></span>
                        </label>
                    </div>
                `).join('');

                return `
                    <div class="habit-card" style="--card-color:${habit.color}">
                        <div style="position:absolute;top:0;right:0;width:4px;height:100%;background:${habit.color};border-radius:0 4px 4px 0;"></div>
                        <div class="habit-card-header">
                            <div class="habit-info">
                                <div class="habit-emoji" style="background:${habit.color}20;">${habit.emoji}</div>
                                <div>
                                    <div class="habit-name">${habit.name}</div>
                                    <div class="habit-streak">${streak > 0 ? `<span class="fire">ğŸ”¥</span> ${streak} ÙŠÙˆÙ… Ù…ØªØªØ§Ù„ÙŠ` : 'Ø§Ø¨Ø¯Ø£ Ø³Ù„Ø³Ù„ØªÙƒ Ø§Ù„ÙŠÙˆÙ…!'}</div>
                                </div>
                            </div>
                            <div style="display:flex;align-items:center;">
                                ${deleteBtn}
                                <span class="habit-progress-badge" style="background:${bgColor}; color:${textColor}; border:1px solid ${habit.color}30;">
                                    ${completed}/${total}
                                </span>
                            </div>
                        </div>
                        <div class="habit-sub-items">${subItemsHtml}</div>
                    </div>
                `;
            } else {
                const isCompleted = todayData[habit.id] || false;
                return `
                    <div class="habit-card">
                        <div style="position:absolute;top:0;right:0;width:4px;height:100%;background:${habit.color};border-radius:0 4px 4px 0;"></div>
                        <div class="habit-card-header">
                            <div class="habit-info">
                                <div class="habit-emoji" style="background:${habit.color}20;">${habit.emoji}</div>
                                <div>
                                    <div class="habit-name">${habit.name}</div>
                                    <div class="habit-streak">${streak > 0 ? `<span class="fire">ğŸ”¥</span> ${streak} ÙŠÙˆÙ… Ù…ØªØªØ§Ù„ÙŠ` : 'Ø§Ø¨Ø¯Ø£ Ø³Ù„Ø³Ù„ØªÙƒ Ø§Ù„ÙŠÙˆÙ…!'}</div>
                                </div>
                            </div>
                            <div style="display:flex;align-items:center;">
                                ${deleteBtn}
                            </div>
                        </div>
                        <button class="habit-toggle-btn ${isCompleted ? 'completed' : ''}" 
                                onclick="toggleBooleanHabit('${habit.id}')"
                                style="${isCompleted ? `border-color:${habit.color}; color:${habit.color}; background:${habit.color}15;` : ''}">
                            ${isCompleted ? 'âœ… ØªÙ… Ø¨Ø­Ù…Ø¯ Ø§Ù„Ù„Ù‡' : 'â¬œ Ø§Ø¶ØºØ· Ù„Ù„ØªØ£ÙƒÙŠØ¯'}
                        </button>
                    </div>
                `;
            }
        }

        /** Render the statistics page */
        function renderStatsPage() {
            renderWeekCalendar();
            renderBarChart();
            renderStreaksList();
        }

        /** Render the weekly calendar view */
        function renderWeekCalendar() {
            const container = document.getElementById('weekCalendar');
            container.innerHTML = '';
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay());

            for (let i = 0; i < 7; i++) {
                const day = new Date(startOfWeek);
                day.setDate(startOfWeek.getDate() + i);
                const dateStr = formatDate(day);
                const isToday = dateStr === getToday();
                const dayData = appData.history[dateStr] || {};

                // Generate completion dots for each habit
                let dotsHtml = '';
                appData.habits.forEach(h => {
                    const completion = getDayHabitCompletion(h, dayData);
                    const dotClass = completion === 1 ? 'completed' : completion > 0 ? 'partial' : '';
                    dotsHtml += `<div class="day-dot ${dotClass}"></div>`;
                });

                container.innerHTML += `
                    <div class="week-day ${isToday ? 'today' : ''}">
                        <div class="day-name">${SHORT_DAYS[i]}</div>
                        <div class="day-num">${day.getDate()}</div>
                        <div class="day-dots">${dotsHtml}</div>
                    </div>
                `;
            }
        }

        /** Render bar chart for weekly performance */
        function renderBarChart() {
            const container = document.getElementById('barChart');
            container.innerHTML = '';
            const today = new Date();

            for (let i = 6; i >= 0; i--) {
                const day = new Date(today);
                day.setDate(today.getDate() - i);
                const dateStr = formatDate(day);
                const pct = getDayTotalCompletion(dateStr);
                const height = Math.max(4, pct * 130 / 100);
                const dayName = SHORT_DAYS[day.getDay()];

                container.innerHTML += `
                    <div class="bar-item">
                        <div class="bar" style="height:${height}px;${pct === 100 ? 'background:linear-gradient(to top,#f59e0b,#fbbf24);' : ''}"></div>
                        <span class="bar-label">${dayName}</span>
                    </div>
                `;
            }
        }

        /** Render streaks list for all habits */
        function renderStreaksList() {
            const container = document.getElementById('streaksList');
            container.innerHTML = '';

            appData.habits.forEach(h => {
                const streak = calculateStreak(h.id);
                container.innerHTML += `
                    <div class="streak-card">
                        <div class="streak-info">
                            <span class="s-emoji">${h.emoji}</span>
                            <span class="s-name">${h.name}</span>
                        </div>
                        <div class="streak-value">
                            ${streak > 0 ? 'ğŸ”¥' : 'ğŸ’¤'}
                            <span>${streak}</span>
                        </div>
                    </div>
                `;
            });
        }

        // ============================================
        // DATA LOGIC
        // ============================================

        /** Toggle a sub-item checkbox (e.g., a specific prayer) */
        function toggleSubItem(habitId, subId, checked) {
            const today = getToday();
            if (!appData.history[today]) appData.history[today] = {};
            if (!appData.history[today][habitId]) appData.history[today][habitId] = {};
            appData.history[today][habitId][subId] = checked;
            saveData();
            renderAll();

            // Haptic feedback
            if (navigator.vibrate) navigator.vibrate(30);

            // Check if everything is completed for confetti
            checkCompletion();
        }

        /** Toggle a boolean habit on/off */
        function toggleBooleanHabit(habitId) {
            const today = getToday();
            if (!appData.history[today]) appData.history[today] = {};
            appData.history[today][habitId] = !appData.history[today][habitId];
            saveData();
            renderAll();

            if (navigator.vibrate) navigator.vibrate(30);
            checkCompletion();
        }

        /** Get completion ratio for a habit on a specific day (0 to 1) */
        function getDayHabitCompletion(habit, dayData) {
            if (habit.type === 'multi') {
                const sub = dayData[habit.id] || {};
                const completed = habit.subItems.filter(s => sub[s.id]).length;
                return habit.subItems.length > 0 ? completed / habit.subItems.length : 0;
            } else {
                return dayData[habit.id] ? 1 : 0;
            }
        }

        /** Get total completion percentage for a date string */
        function getDayTotalCompletion(dateStr) {
            const dayData = appData.history[dateStr] || {};
            let total = 0, completed = 0;

            appData.habits.forEach(h => {
                if (h.type === 'multi') {
                    total += h.subItems.length;
                    const sub = dayData[h.id] || {};
                    completed += h.subItems.filter(s => sub[s.id]).length;
                } else {
                    total += 1;
                    if (dayData[h.id]) completed += 1;
                }
            });

            return total > 0 ? Math.round((completed / total) * 100) : 0;
        }

        /** Calculate current streak for a specific habit */
        function calculateStreak(habitId) {
            let streak = 0;
            const habit = appData.habits.find(h => h.id === habitId);
            if (!habit) return 0;

            const date = new Date();

            while (true) {
                const dateStr = formatDate(date);
                const dayData = appData.history[dateStr] || {};

                if (getDayHabitCompletion(habit, dayData) >= 1) {
                    streak++;
                    date.setDate(date.getDate() - 1);
                } else {
                    // Allow today to be incomplete without breaking streak
                    if (dateStr === getToday() && streak === 0) {
                        date.setDate(date.getDate() - 1);
                        continue;
                    }
                    break;
                }
            }

            return streak;
        }

        /** Get the best streak across all habits */
        function getBestStreak() {
            let best = 0;
            appData.habits.forEach(h => {
                const s = calculateStreak(h.id);
                if (s > best) best = s;
            });
            return best;
        }

        /** Check if all tasks are completed today and celebrate */
        function checkCompletion() {
            const pct = getDayTotalCompletion(getToday());
            if (pct === 100) {
                showConfetti();
                showToast('ğŸ‰ Ù…Ø§ Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡! Ø£ÙƒÙ…Ù„Øª Ø¬Ù…ÙŠØ¹ Ø¹Ø§Ø¯Ø§ØªÙƒ Ø§Ù„ÙŠÙˆÙ…');
            }
        }

        // ============================================
        // HABIT MANAGEMENT
        // ============================================

        /** Add a new custom habit */
        function addNewHabit() {
            const name = document.getElementById('habitNameInput').value.trim();
            if (!name) {
                showToast('âš ï¸ Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¯Ø©');
                return;
            }

            // Check for duplicate names
            if (appData.habits.find(h => h.name === name)) {
                showToast('âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ø§Ø¯Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© Ø¨Ø§Ù„ÙØ¹Ù„');
                return;
            }

            const newHabit = {
                id: 'habit_' + Date.now(),
                name: name,
                emoji: selectedEmoji,
                color: selectedColor,
                type: 'boolean',
                deletable: true
            };

            appData.habits.push(newHabit);
            saveData();
            renderAll();
            closeAddModal();
            showToast('âœ… ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø§Ø¯Ø© Ø¨Ù†Ø¬Ø§Ø­');
            if (navigator.vibrate) navigator.vibrate(50);
        }

        /** Delete a custom habit */
        function deleteHabit(habitId, event) {
            event.stopPropagation();
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ø§Ø¯Ø©ØŸ')) {
                appData.habits = appData.habits.filter(h => h.id !== habitId);
                // Clean up history entries for this habit
                Object.keys(appData.history).forEach(date => {
                    if (appData.history[date][habitId]) {
                        delete appData.history[date][habitId];
                    }
                });
                saveData();
                renderAll();
                showToast('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ø§Ø¯Ø©');
            }
        }

        /** Apply a suggestion to the add habit form */
        function applySuggestion(emoji, name, color) {
            document.getElementById('habitNameInput').value = name;
            selectedEmoji = emoji;
            selectedColor = color;

            // Update visual selection in emoji grid
            document.querySelectorAll('.emoji-option').forEach(el => {
                el.classList.toggle('selected', el.textContent.trim() === emoji);
            });
            // Update visual selection in color grid
            document.querySelectorAll('.color-option').forEach(el => {
                el.classList.toggle('selected', el.dataset.color === color);
            });

            if (navigator.vibrate) navigator.vibrate(20);
        }

        // ============================================
        // MODAL & UI INTERACTIONS
        // ============================================

        /** Open the add habit modal */
        function openAddModal() {
            document.getElementById('addModal').classList.add('active');
            document.getElementById('habitNameInput').value = '';
            selectedEmoji = 'ğŸ“–';
            selectedColor = '#10b981';
            buildEmojiGrid();
            buildColorGrid();
        }

        /** Close the add habit modal */
        function closeAddModal() {
            document.getElementById('addModal').classList.remove('active');
        }

        /** Build the emoji picker grid */
        function buildEmojiGrid() {
            const grid = document.getElementById('emojiGrid');
            grid.innerHTML = '';
            EMOJIS.forEach(e => {
                const div = document.createElement('div');
                div.className = `emoji-option ${e === selectedEmoji ? 'selected' : ''}`;
                div.textContent = e;
                div.onclick = () => {
                    selectedEmoji = e;
                    document.querySelectorAll('.emoji-option').forEach(el => el.classList.remove('selected'));
                    div.classList.add('selected');
                    if (navigator.vibrate) navigator.vibrate(15);
                };
                grid.appendChild(div);
            });
        }

        /** Build the color picker grid */
        function buildColorGrid() {
            const grid = document.getElementById('colorGrid');
            grid.innerHTML = '';
            COLORS.forEach(c => {
                const div = document.createElement('div');
                div.className = `color-option ${c === selectedColor ? 'selected' : ''}`;
                div.style.background = c;
                div.dataset.color = c;
                div.onclick = () => {
                    selectedColor = c;
                    document.querySelectorAll('.color-option').forEach(el => el.classList.remove('selected'));
                    div.classList.add('selected');
                    if (navigator.vibrate) navigator.vibrate(15);
                };
                grid.appendChild(div);
            });
        }

        /** Switch between pages (home, habits, stats, settings) */
        function switchPage(pageId, navItem) {
            // Hide all pages, then show the selected one
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-' + pageId).classList.add('active');

            // Update nav active state
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            if (navItem) navItem.classList.add('active');

            // FAB button always visible on all pages
            document.getElementById('fabBtn').style.display = 'flex';

            // Re-render specific pages when switching to them
            if (pageId === 'stats') renderStatsPage();
            if (pageId === 'home') renderHomePage();

            if (navigator.vibrate) navigator.vibrate(10);
        }

        /** Show a toast notification message */
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        /** Show confetti celebration animation */
        function showConfetti() {
            const container = document.getElementById('confettiContainer');
            container.innerHTML = '';

            const colors = ['#10b981', '#f59e0b', '#3b82f6', '#ef4444', '#8b5cf6', '#ec4899', '#fbbf24'];

            for (let i = 0; i < 50; i++) {
                const piece = document.createElement('div');
                piece.className = 'confetti-piece';
                piece.style.left = Math.random() * 100 + '%';
                piece.style.animationDelay = Math.random() * 2 + 's';
                piece.style.animationDuration = (Math.random() * 2 + 2) + 's';
                piece.style.background = colors[Math.floor(Math.random() * colors.length)];
                piece.style.borderRadius = Math.random() > 0.5 ? '50%' : '2px';
                piece.style.width = (Math.random() * 8 + 4) + 'px';
                piece.style.height = (Math.random() * 8 + 4) + 'px';
                container.appendChild(piece);
            }

            // Clean up confetti after animation
            setTimeout(() => { container.innerHTML = ''; }, 5000);
        }

        // ============================================
        // SETTINGS FUNCTIONS
        // ============================================

        /** Toggle notification setting */
        function toggleNotifications() {
            const toggle = document.getElementById('notifToggle');
            toggle.checked = !toggle.checked;
            appData.settings.notifications = toggle.checked;
            saveData();

            if (toggle.checked && 'Notification' in window) {
                Notification.requestPermission().then(perm => {
                    if (perm === 'granted') {
                        showToast('ğŸ”” ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª');
                    } else {
                        toggle.checked = false;
                        appData.settings.notifications = false;
                        saveData();
                        showToast('âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª');
                    }
                });
            } else {
                showToast(toggle.checked ? 'ğŸ”” ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª' : 'ğŸ”• ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª');
            }
        }

        /** Export all app data as a JSON file */
        function exportData() {
            const dataStr = JSON.stringify(appData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `habits_backup_${getToday()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('ğŸ“¤ ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
        }

        /** Trigger file input click for importing data */
        function importDataClick() {
            document.getElementById('importFile').click();
        }

        /** Import data from a selected JSON file */
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (imported.habits && imported.history) {
                        appData = imported;
                        saveData();
                        renderAll();
                        showToast('ğŸ“¥ ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­');
                    } else {
                        showToast('âš ï¸ Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­');
                    }
                } catch (err) {
                    showToast('âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        /** Reset all app data to defaults */
        function resetAllData() {
            if (confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹!')) {
                if (confirm('ØªØ£ÙƒÙŠØ¯ Ø£Ø®ÙŠØ±: Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ')) {
                    localStorage.removeItem(STORAGE_KEY);
                    appData = {
                        habits: [...DEFAULT_HABITS],
                        history: {},
                        settings: { notifications: false }
                    };
                    saveData();
                    renderAll();
                    showToast('ğŸ—‘ï¸ ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                }
            }
        }

        // ============================================
        // PWA - SERVICE WORKER & INSTALL
        // ============================================

        /** Register the service worker for offline support */
        function registerSW() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('SW registered:', reg.scope))
                    .catch(err => console.log('SW registration failed:', err));
            }
        }

        /** Handle the PWA install prompt */
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installBanner').classList.add('show');
        });

        /** Trigger app installation */
        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then(choice => {
                    if (choice.outcome === 'accepted') {
                        showToast('ğŸ‰ ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚!');
                    }
                    deferredPrompt = null;
                    document.getElementById('installBanner').classList.remove('show');
                });
            }
        }

        /** Dismiss the install banner */
        function dismissInstall() {
            document.getElementById('installBanner').classList.remove('show');
        }

        // Close modal when clicking on the overlay background
        document.getElementById('addModal').addEventListener('click', (e) => {
            if (e.target === e.currentTarget) closeAddModal();
        });
    </script>
</body>
</html>
